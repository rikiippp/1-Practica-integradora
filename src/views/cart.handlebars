<header>
    <a href="http://localhost:8080/api/products"><img src="/uploads/icon-clock.png" alt="Preview Icon"></a>
    <ul>
        <li><a href="http://localhost:8080/api/products">Home</a></li>
        <li><a href="http://localhost:8080/api/products">Sign in</a></li>
        <li class="dropdown">
            <a href="http://localhost:8080/api/products" class="dropbtn">Cart</a>
            <div class="dropdown-content" id="cartDropdown">
                <!-- Los link del carrito se agregan aca dinámicamente -->
            </div>
        </li>
    </ul>
</header>

<main>
    <div class="cart-container">
        <h1>SHOPPING CART</h1>
        <div class="table-container">
            <table>
                <tr>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Remove</th>
                </tr>
                {{#each cart}}
                <tr>
                    <td class="td-item">
                        <div class="td-item-container">
                            <img src="{{this.productId.image}}" alt="{{this.productId.title}}">
                            <span class="td-product-title">{{this.productId.title}}</span>
                        </div>
                    </td>
                    <td class="td-price">${{this.productId.price}}</td>
                    <td class="td-quantity">{{this.quantity}}</td>
                    <td class="td-total">${{this.total}}</td>
                    <td class="td-remove"><button>Remove</button></td>
                </tr>
                {{/each}}
            </table>
        </div>
    </div>

    <div class="icon-chat">
        <a href="http://localhost:8080/api/chat"><img src="/uploads/1708456649794-message.png" alt="Icon Chat"></a>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', async function () {
        const dropdown = document.querySelector('.dropdown');
        const dropdownContent = document.getElementById('cartDropdown');

        // Obtengo todos los carritos
        const carts = await fetch('http://localhost:8080/api/carts').then(response => response.json());

        // Aca genero dinámicamente los links del menú desplegable
        carts.forEach(cart => {
            const link = document.createElement('a');
            link.href = `http://localhost:8080/api/carts/${cart._id}`;
            link.textContent = `Cart ${cart._id}`;
            dropdownContent.appendChild(link);
        });
        console.log(carts)

        // Muestro el submenu
        dropdown.addEventListener('click', function (event) {
            event.stopPropagation();
            dropdownContent.classList.toggle('show');
        });

        // Oculto el menu al clickear afuera del link
        document.addEventListener('click', function (event) {
            if (!dropdown.contains(event.target)) {
                dropdownContent.classList.remove('show');
            }
        });
    });


</script>